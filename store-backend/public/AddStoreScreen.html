<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... [Other head elements] -->
    <title>Add Store</title>
    <style>
        .logo-preview {
            max-width: 200px;
            max-height: 200px;
            display: none;
        }
        .category-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        .category-checkbox {
            display: flex;
            align-items: center;
        }
    </style>
</head>
<body>
    <!-- ... [Navigation and other elements] -->

    <h1>Add a New Store</h1>
    <form id="addStoreForm">
        <!-- ... [Other form fields] -->

        <label>Categories:</label>
        <div class="category-checkboxes">
            <div class="category-checkbox">
                <input type="checkbox" id="all" name="categories" value="All" onchange="handleCategorySelection('All')">
                <label for="all">All</label>
            </div>
            <div class="category-checkbox">
                <input type="checkbox" id="thc" name="categories" value="THC" onchange="handleCategorySelection('THC')">
                <label for="thc">THC</label>
            </div>
            <div class="category-checkbox">
                <input type="checkbox" id="cbd" name="categories" value="CBD" onchange="handleCategorySelection('CBD')">
                <label for="cbd">CBD</label>
            </div>
            <div class="category-checkbox">
                <input type="checkbox" id="clubs" name="categories" value="Clubs" onchange="handleCategorySelection('Clubs')">
                <label for="clubs">Clubs</label>
            </div>
            <div class="category-checkbox">
                <input type="checkbox" id="flower" name="categories" value="Flower" onchange="handleCategorySelection('Flower')">
                <label for="flower">Flower</label>
            </div>
            <div class="category-checkbox">
                <input type="checkbox" id="edibles" name="categories" value="Edibles" onchange="handleCategorySelection('Edibles')">
                <label for="edibles">Edibles</label>
            </div>
            <div class="category-checkbox">
                <input type="checkbox" id="delivery" name="categories" value="Delivery" onchange="handleCategorySelection('Delivery')">
                <label for="delivery">Delivery</label>
            </div>
            <div class="category-checkbox">
                <input type="checkbox" id="oils" name="categories" value="Oils" onchange="handleCategorySelection('Oils')">
                <label for="oils">Oils</label>
            </div>
        </div>

        <!-- ... [Other form fields] -->

        <button type="button" onclick="addStore()">Add Store</button>
    </form>

    <script>
        function previewLogo() {
            const logoInput = document.getElementById('logo');
            const logoPreview = document.getElementById('logoPreview');

            const file = logoInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    logoPreview.src = e.target.result;
                    logoPreview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                logoPreview.src = '';
                logoPreview.style.display = 'none';
            }
        }

        // Function to handle mutual exclusivity between 'All' and other categories
        function handleCategorySelection(selectedCategory) {
            const allCheckbox = document.getElementById('all');
            const otherCategories = ['thc', 'cbd', 'clubs', 'flower', 'edibles', 'delivery', 'oils'];

            if (selectedCategory === 'All') {
                if (allCheckbox.checked) {
                    // Uncheck all other categories
                    otherCategories.forEach(cat => {
                        document.getElementById(cat).checked = false;
                    });
                }
            } else {
                if (document.getElementById(selectedCategory.toLowerCase()).checked) {
                    // Uncheck 'All' if any other category is selected
                    if (allCheckbox.checked) {
                        allCheckbox.checked = false;
                    }
                }
            }
        }

        function getSelectedCategories() {
            const checkboxes = document.querySelectorAll('input[name="categories"]:checked');
            const categories = Array.from(checkboxes).map(checkbox => checkbox.value);
            return [...new Set(categories)]; // Remove duplicates
        }

        async function addStore() {
            const form = document.getElementById('addStoreForm');
            const formData = new FormData(form);

            // Get selected categories
            let selectedCategories = getSelectedCategories();

            // Remove duplicates (already done with Set)
            // Handle 'All' category: if 'All' is selected, ignore other categories
            if (selectedCategories.includes('All') && selectedCategories.length > 1) {
                selectedCategories = ['All'];
            }

            // Clear existing categories in FormData to avoid duplication
            formData.delete('categories');

            // Append unique categories to formData
            selectedCategories.forEach(category => formData.append('categories', category));

            try {
                const response = await fetch('http://localhost:5000/api/stores', {
                    method: 'POST',
                    body: formData
                    // Note: Do NOT set the 'Content-Type' header when sending FormData. The browser will set it automatically, including the boundary.
                });

                if (response.ok) {
                    alert('Store added successfully');
                    form.reset();
                    document.getElementById('logoPreview').style.display = 'none';
                } else {
                    const errorData = await response.json();
                    alert('Failed to add store: ' + (errorData.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error adding store:', error);
                alert('Error adding store');
            }
        }
    </script>
</body>
</html>
